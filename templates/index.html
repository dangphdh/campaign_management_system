{% extends "layout.html" %}
{% block content %}
<h2>Campaign Groups</h2>
{% for group in groups %}
    <div class="group">
        <h3>
            <i class="material-icons">folder</i>
            {{ group.name }}
            <a href="{{ url_for('group_dashboard', group_id=group._id) }}">
                <i class="material-icons">dashboard</i> View Dashboard
            </a>
            <a href="{{ url_for('edit_group', group_id=group._id) }}">
                <i class="material-icons">edit</i> Edit Group
            </a>
        </h3>
        {% if group.powerbi_link %}
            <p><strong>Power BI Report:</strong> <a href="{{ group.powerbi_link }}" target="_blank">Open Report</a></p>
        {% else %}
            <p><em>No Power BI report linked</em></p>
        {% endif %}
        <ul>
            {% for campaign in group.campaigns %}
                <li>
                    <i class="material-icons">campaign</i>
                    {{ campaign.name }} ({{ campaign.product.name }})
                    <a href="{{ url_for('edit_campaign', campaign_id=campaign._id) }}">
                        <i class="material-icons">edit</i> Edit
                    </a>
                    <ul>
                        {% for conversion in campaign.conversions %}
                            <li>
                                <i class="material-icons">trending_up</i>
                                {{ conversion.action }} ({{ conversion.product.name }})
                                <a href="{{ url_for('edit_conversion', conversion_id=conversion._id) }}">
                                    <i class="material-icons">edit</i> Edit
                                </a>
                            </li>
                        {% endfor %}
                    </ul>
                </li>
            {% endfor %}
        </ul>
    </div>
{% endfor %}
<a href="{{ url_for('add_group') }}" class="btn btn-primary">Add New Group</a>
<a href="{{ url_for('add_campaign') }}" class="btn btn-primary">Add New Campaign</a>
<a href="{{ url_for('add_conversion') }}" class="btn btn-primary">Add New Conversion</a>
{% endblock %}